import{d as re,r as y,n as de,o as ue,a as u,c as C,b as p,e as n,w as t,f as i,i as f,F as j,j as B,p as ce,t as x,g as _,h as pe,l as me,m as fe}from"./index.js";const ye={style:{width:"100%",height:"100%",padding:"0"}},_e={style:{padding:"16px"}},ge={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ve={style:{"font-size":"13px",padding:"6px 8px",border:"1px solid #eee","border-radius":"6px"}},xe={style:{display:"flex",gap:"8px","margin-top":"8px"}},we={style:{display:"flex","justify-content":"space-between","align-items":"center"}},he={style:{display:"flex","justify-content":"space-between",gap:"8px","align-items":"center"}},be={style:{"font-size":"12px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","max-width":"520px"}},ke={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ce={style:{display:"flex","justify-content":"space-between",gap:"8px","align-items":"flex-start"}},Ae={style:{flex:"1","min-width":"0"}},Ee={style:{"font-weight":"600","font-size":"14px","margin-bottom":"4px"}},Fe={style:{"font-size":"12px",color:"#666","margin-bottom":"6px"}},ze={style:{"font-size":"12px",color:"#444"}},Re={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Se={style:{display:"flex","justify-content":"space-between",gap:"8px","align-items":"center"}},Ne={style:{"font-weight":"600","font-size":"13px"}},Te={style:{"font-size":"12px",color:"#666"}},je=re({__name:"App",setup(Be){function I(l,e){try{return new URL(e,l).toString()}catch{return e}}function W(l,e){const r=new DOMParser().parseFromString(l,"text/html"),a=Array.from(r.querySelectorAll('link[rel="alternate"]')).filter(s=>{const c=(s.getAttribute("type")||"").toLowerCase();return c.includes("rss")||c.includes("atom")||c.includes("xml")}).map(s=>I(e,s.getAttribute("href")||"")),d=Array.from(r.querySelectorAll("a")).filter(s=>{const c=(s.getAttribute("href")||"").toLowerCase();return c.includes("rss")||c.includes("atom")||c.endsWith(".xml")}).map(s=>I(e,s.getAttribute("href")||"")),m=new Set([...a,...d].filter(s=>!!s));return Array.from(m)}function G(l){const e=new DOMParser().parseFromString(l,"text/xml"),r=[];return Array.from(e.getElementsByTagName("item")).forEach(d=>{const m=d.getElementsByTagName("title")[0]?.textContent||"",s=d.getElementsByTagName("link")[0]?.textContent||"",c=d.getElementsByTagName("description")[0]?.textContent||"";r.push({title:m,link:s,description:c})}),r.length===0&&Array.from(e.getElementsByTagName("entry")).forEach(m=>{const s=m.getElementsByTagName("title")[0]?.textContent||"",E=m.getElementsByTagName("link")[0]?.getAttribute("href")||"",F=m.getElementsByTagName("summary")[0]?.textContent||m.getElementsByTagName("content")[0]?.textContent||"";r.push({title:s,link:E||"",description:F})}),r}function H(l){if(!l||l.length===0)return"";const e=l.length,r={创建:[/新建|创建|添加/],管理:[/管理|维护|配置/],审批:[/审批|审核|流程/],报表:[/报表|统计|分析|导出/],用户:[/用户|员工|账号|权限/],集成:[/集成|API|接口|Webhook/]},a={};Object.keys(r).forEach(s=>a[s]=0),l.forEach(s=>{const c=(s.title+" "+s.description).toLowerCase();Object.entries(r).forEach(([E,F])=>{F.some(g=>g.test(c))&&a[E]++})});const d=Object.entries(a).filter(([,s])=>s>0).map(([s,c])=>`${s}${c>1?"等":""}`),m=d.includes("审批")?"适合需要流程与权限控制的业务场景":d.includes("报表")?"适合数据分析与导出场景":"适合常规业务操作与导航引导";return`检测到 ${e} 个功能项，包含 ${d.join("、")} 等模块；${m}`}const M=y("playground"),L=y("Ask"),A=y(""),z=y([]),h=y(""),w=y([]),$=y(!1),b=y([]),R=y(""),P=y(""),S=y([]),O=de(()=>{const l=P.value.trim().toLowerCase();return l?b.value.filter(e=>(e.title+" "+e.description).toLowerCase().includes(l)):b.value});async function Q(){if(h.value){$.value=!0,w.value=[];try{const e=await(await fetch(h.value)).text(),r=h.value,a=W(e,r),d=["feed","rss.xml","atom.xml","index.xml","blog/rss.xml","feeds/posts/default?alt=rss"].map(m=>I(r,r.endsWith("/")?m:"/"+m));w.value=Array.from(new Set([...a,...d]))}catch{}$.value=!1}}async function Y(){w.value.length!==0&&await U(w.value[0])}async function U(l){try{const r=await(await fetch(l)).text(),a=G(r);a.length>0&&(b.value=a,R.value=H(a))}catch{}}async function J(l){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e&&l&&await chrome.tabs.update(e.id,{url:l})}function K(l){chrome.runtime.sendMessage({type:"SET_INTENT",intent:l})}async function X(){const l={site:h.value||"",time:Date.now(),items:b.value},e=await chrome.storage.local.get(["assistantFeedRecords"]),r=Array.isArray(e.assistantFeedRecords)?e.assistantFeedRecords:[];r.unshift(l),await chrome.storage.local.set({assistantFeedRecords:r}),await N()}async function N(){const l=await chrome.storage.local.get(["assistantFeedRecords"]);S.value=Array.isArray(l.assistantFeedRecords)?l.assistantFeedRecords:[]}async function Z(l){const e=[...S.value];e.splice(l,1),await chrome.storage.local.set({assistantFeedRecords:e}),await N()}async function ee(){b.value=[],R.value=""}ue(N);async function te(){z.value.push({role:"user",text:A.value});const[l]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!l){z.value.push({role:"assistant",text:"没有活动标签页"});return}const e=await new Promise(a=>chrome.tabs.sendMessage(l.id,{type:"CHAT_RUN",mode:L.value,text:A.value},d=>a(d))),r=e&&e.result?String(e.result):"已发送";z.value.push({role:"assistant",text:r}),A.value=""}return(l,e)=>{const r=u("el-input"),a=u("el-button"),d=u("el-space"),m=u("el-header"),s=u("el-radio-button"),c=u("el-radio-group"),E=u("el-tag"),F=u("el-scrollbar"),g=u("el-card"),V=u("el-tab-pane"),q=u("el-empty"),ne=u("el-timeline-item"),le=u("el-timeline"),k=u("el-col"),se=u("el-alert"),D=u("el-row"),oe=u("el-tabs"),ae=u("el-main"),ie=u("el-container");return p(),C("div",ye,[n(ie,null,{default:t(()=>[n(m,{height:"52px",style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0 16px"}},{default:t(()=>[e[7]||(e[7]=i("div",{style:{"font-weight":"600"}},"网站指南",-1)),n(d,null,{default:t(()=>[n(r,{"model-value":h.value,onInput:e[0]||(e[0]=o=>h.value=o),placeholder:"输入网站地址",style:{width:"320px"}},null,8,["model-value"]),n(a,{loading:$.value,onClick:Q},{default:t(()=>[...e[5]||(e[5]=[f("发现RSS",-1)])]),_:1},8,["loading"]),n(a,{disabled:w.value.length===0,onClick:Y},{default:t(()=>[...e[6]||(e[6]=[f("拉取第一个",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),n(ae,{style:{padding:"0"}},{default:t(()=>[n(oe,{"model-value":M.value,"onUpdate:modelValue":e[4]||(e[4]=o=>M.value=o)},{default:t(()=>[n(V,{label:"Playground",name:"playground"},{default:t(()=>[i("div",_e,[n(g,{shadow:"never"},{header:t(()=>[i("div",ge,[e[8]||(e[8]=i("span",null,"Playground",-1)),n(d,null,{default:t(()=>[n(c,{"model-value":L.value,onChange:e[1]||(e[1]=o=>L.value=o),size:"small"},{default:t(()=>[n(s,{label:"Action"}),n(s,{label:"Tap"}),n(s,{label:"Query"}),n(s,{label:"Assert"}),n(s,{label:"Ask"})]),_:1},8,["model-value"])]),_:1})])]),default:t(()=>[n(F,{height:"420px"},{default:t(()=>[(p(!0),C(j,null,B(z.value,(o,v)=>(p(),C("div",{key:v,style:{padding:"8px"}},[i("div",{style:ce(o.role==="user"?"text-align:right":"text-align:left")},[n(E,{type:o.role==="user"?"primary":"info",effect:"plain"},{default:t(()=>[f(x(o.role==="user"?"You":"Assistant"),1)]),_:2},1032,["type"])],4),i("div",ve,x(o.text),1)]))),128))]),_:1}),i("div",xe,[n(r,{"model-value":A.value,onInput:e[2]||(e[2]=o=>A.value=o),placeholder:"请输入指令或选择器"},null,8,["model-value"]),n(a,{type:"primary",onClick:te},{default:t(()=>[...e[9]||(e[9]=[f("Run",-1)])]),_:1})])]),_:1})])]),_:1}),n(V,{label:"Guide",name:"guide"},{default:t(()=>[n(D,{gutter:12,style:{padding:"16px"}},{default:t(()=>[n(k,{span:24},{default:t(()=>[n(g,{shadow:"never"},{header:t(()=>[i("div",we,[e[11]||(e[11]=i("span",null,"候选RSS",-1)),n(a,{size:"small",onClick:X,disabled:b.value.length===0},{default:t(()=>[...e[10]||(e[10]=[f("保存记录",-1)])]),_:1},8,["disabled"])])]),default:t(()=>[w.value.length===0?(p(),_(q,{key:0,description:"尚未发现候选"})):(p(),_(le,{key:1},{default:t(()=>[(p(!0),C(j,null,B(w.value,(o,v)=>(p(),_(ne,{key:v,timestamp:""},{default:t(()=>[i("div",he,[i("div",be,x(o),1),i("div",null,[n(a,{size:"small",onClick:T=>U(o)},{default:t(()=>[...e[12]||(e[12]=[f("拉取",-1)])]),_:1},8,["onClick"])])])]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),R.value?(p(),_(k,{key:0,span:24},{default:t(()=>[n(se,{title:R.value,type:"info","show-icon":""},null,8,["title"])]),_:1})):pe("",!0),n(k,{span:24},{default:t(()=>[n(g,{shadow:"never"},{header:t(()=>[i("div",ke,[e[14]||(e[14]=i("span",null,"功能项",-1)),n(d,null,{default:t(()=>[n(r,{"model-value":P.value,onInput:e[3]||(e[3]=o=>P.value=o),placeholder:"搜索功能",style:{width:"220px"}},null,8,["model-value"]),n(a,{size:"small",onClick:ee},{default:t(()=>[...e[13]||(e[13]=[f("清空",-1)])]),_:1})]),_:1})])]),default:t(()=>[O.value.length===0?(p(),_(q,{key:0,description:"暂无数据"})):(p(),_(D,{key:1,gutter:12},{default:t(()=>[(p(!0),C(j,null,B(O.value,(o,v)=>(p(),_(k,{key:v,span:24},{default:t(()=>[n(g,{shadow:"hover","body-style":"padding:12px"},{default:t(()=>[i("div",Ce,[i("div",Ae,[i("div",Ee,x(o.title),1),i("div",Fe,x(o.link),1),i("div",ze,x(o.description),1)]),i("div",null,[n(d,null,{default:t(()=>[n(a,{size:"small",onClick:T=>J(o.link)},{default:t(()=>[...e[15]||(e[15]=[f("打开",-1)])]),_:1},8,["onClick"]),n(a,{size:"small",onClick:T=>K(o.title)},{default:t(()=>[...e[16]||(e[16]=[f("作为意图",-1)])]),_:1},8,["onClick"])]),_:2},1024)])])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1}),n(k,{span:24},{default:t(()=>[n(g,{shadow:"never"},{header:t(()=>[i("div",Re,[e[18]||(e[18]=i("span",null,"记录管理",-1)),n(a,{size:"small",onClick:N},{default:t(()=>[...e[17]||(e[17]=[f("刷新",-1)])]),_:1})])]),default:t(()=>[S.value.length===0?(p(),_(q,{key:0,description:"暂无记录"})):(p(),_(D,{key:1,gutter:12},{default:t(()=>[(p(!0),C(j,null,B(S.value,(o,v)=>(p(),_(k,{key:v,span:24},{default:t(()=>[n(g,{"body-style":"padding:12px"},{default:t(()=>[i("div",Se,[i("div",null,[i("div",Ne,x(o.site),1),i("div",Te,x(new Date(o.time).toLocaleString()),1)]),n(d,null,{default:t(()=>[n(a,{size:"small",onClick:T=>l.loadRecord(o)},{default:t(()=>[...e[19]||(e[19]=[f("载入",-1)])]),_:1},8,["onClick"]),n(a,{size:"small",type:"danger",onClick:T=>Z(v)},{default:t(()=>[...e[20]||(e[20]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1})])}}});me(je).use(fe).mount("#sidepanel-app");
