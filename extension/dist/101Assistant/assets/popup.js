import{d as pe,r as v,o as fe,a as d,c as y,b as f,e as t,w as l,f as c,g as j,h as $,i as p,F as R,j as O,t as k,u as ve,k as ye,l as _e,m as ge}from"./index.js";const xe={style:{padding:"0",width:"360px"}},be={style:{display:"flex",gap:"8px"}},we={key:0},he={key:1},ke={style:{display:"flex",gap:"8px","margin-top":"8px"}},Ce={style:{display:"flex",gap:"8px"}},Ae={key:0,style:{"margin-bottom":"8px"}},Ee={style:{"font-size":"12px",color:"#666"}},Fe={style:{"font-size":"12px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","max-width":"220px"}},Se={key:1},Ne={style:{display:"flex","justify-content":"space-between",gap:"8px","align-items":"center"}},ze={style:{overflow:"hidden"}},Ie={style:{"font-weight":"600","font-size":"13px"}},Be={style:{"font-size":"12px",color:"#666"}},Te={style:{"font-size":"12px",color:"#444"}},Le={style:{display:"flex",gap:"6px"}},je=pe({__name:"App",setup($e){const w=v(!1),x=v({username:"",token:""}),P=v("assistant"),C=v(""),S=v("guided"),z=v(""),I=v(""),M=v([]),_=v([]),h=v(""),A=v(""),g=v([]),B=v(!1);function U(a){M.value.push(a)}async function H(){const a=await chrome.storage.local.get(["assistantAuth"]);a&&a.assistantAuth?(w.value=!0,x.value=a.assistantAuth):w.value=!1}async function J(){await chrome.storage.local.set({assistantAuth:x.value}),w.value=!0}async function K(){await chrome.storage.local.remove(["assistantAuth"]),w.value=!1}async function Q(){U("发送: "+C.value+" 模式: "+S.value);const[a]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!a){U("没有活动标签页");return}await chrome.runtime.sendMessage({type:"RUN_INTENT",tabId:a.id,intent:C.value,mode:S.value,inputs:{name:z.value,dept:I.value}})}fe(H);function V(a){const e=new DOMParser().parseFromString(a,"text/xml"),n=[];return Array.from(e.getElementsByTagName("item")).forEach(u=>{const i=u.getElementsByTagName("title")[0]?.textContent||"",o=u.getElementsByTagName("link")[0]?.textContent||"",r=u.getElementsByTagName("description")[0]?.textContent||"";n.push({title:i,link:o,description:r})}),n.length===0&&Array.from(e.getElementsByTagName("entry")).forEach(i=>{const o=i.getElementsByTagName("title")[0]?.textContent||"",b=i.getElementsByTagName("link")[0]?.getAttribute("href")||"",E=i.getElementsByTagName("summary")[0]?.textContent||i.getElementsByTagName("content")[0]?.textContent||"";n.push({title:o,link:b||"",description:E})}),n}async function X(a){const e=a.raw;if(!e)return;const n=new FileReader;n.onload=()=>{const m=String(n.result||"");_.value=V(m),h.value=T(_.value)},n.readAsText(e)}async function Y(){await chrome.storage.local.set({assistantFeed:_.value})}async function Z(){const a=await chrome.storage.local.get(["assistantFeed"]);_.value=a.assistantFeed||[],h.value=T(_.value)}async function ee(){_.value=[],await chrome.storage.local.remove(["assistantFeed"]),h.value=""}async function te(a){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});e&&a&&await chrome.tabs.update(e.id,{url:a})}async function le(){await chrome.runtime.sendMessage({type:"OPEN_SIDEPANEL"})}function T(a){if(!a||a.length===0)return"";const e=a.length,n={创建:[/新建|创建|添加/],管理:[/管理|维护|配置/],审批:[/审批|审核|流程/],报表:[/报表|统计|分析|导出/],用户:[/用户|员工|账号|权限/],集成:[/集成|API|接口|Webhook/]},m={};Object.keys(n).forEach(o=>m[o]=0),a.forEach(o=>{const r=(o.title+" "+o.description).toLowerCase();Object.entries(n).forEach(([b,E])=>{E.some(N=>N.test(r))&&m[b]++})});const u=Object.entries(m).filter(([,o])=>o>0).map(([o,r])=>`${o}${r>1?"等":""}`),i=u.includes("审批")?"适合需要流程与权限控制的业务场景":u.includes("报表")?"适合数据分析与导出场景":"适合常规业务操作与导航引导";return`检测到 ${e} 个功能项，包含 ${u.join("、")} 等模块；${i}`}function L(a,e){try{return new URL(e,a).toString()}catch{return e}}function ne(a,e){const n=new DOMParser().parseFromString(a,"text/html"),m=Array.from(n.querySelectorAll('link[rel="alternate"]')).filter(o=>{const r=(o.getAttribute("type")||"").toLowerCase();return r.includes("rss")||r.includes("atom")||r.includes("xml")}).map(o=>L(e,o.getAttribute("href")||"")),u=Array.from(n.querySelectorAll("a")).filter(o=>{const r=(o.getAttribute("href")||"").toLowerCase();return r.includes("rss")||r.includes("atom")||r.endsWith(".xml")}).map(o=>L(e,o.getAttribute("href")||"")),i=new Set([...m,...u].filter(o=>!!o));return Array.from(i)}async function ae(){if(A.value){B.value=!0,g.value=[];try{const e=await(await fetch(A.value)).text(),n=A.value,m=ne(e,n),u=["feed","rss.xml","atom.xml","index.xml","blog/rss.xml","feeds/posts/default?alt=rss"].map(i=>L(n,n.endsWith("/")?i:"/"+i));g.value=Array.from(new Set([...m,...u]))}catch{}B.value=!1}}async function oe(){g.value.length!==0&&await W(g.value[0])}async function W(a){try{const n=await(await fetch(a)).text(),m=V(n);m.length>0&&(_.value=m,h.value=T(m))}catch{}}return(a,e)=>{const n=d("el-button"),m=d("el-header"),u=d("el-input"),i=d("el-form-item"),o=d("el-form"),r=d("el-card"),b=d("el-radio"),E=d("el-radio-group"),N=d("el-divider"),q=d("el-scrollbar"),D=d("el-tab-pane"),se=d("el-icon"),ie=d("el-upload"),ue=d("el-alert"),re=d("el-empty"),de=d("el-tabs"),me=d("el-main"),ce=d("el-container");return f(),y("div",xe,[t(ce,null,{default:l(()=>[t(m,{height:"48px",style:{display:"flex","align-items":"center","justify-content":"space-between",padding:"0 12px"}},{default:l(()=>[e[10]||(e[10]=c("div",{style:{"font-weight":"600"}},"网站助手",-1)),c("div",be,[t(n,{size:"small",onClick:le},{default:l(()=>[...e[8]||(e[8]=[p("打开侧边栏",-1)])]),_:1}),w.value?(f(),j(n,{key:0,size:"small",onClick:K},{default:l(()=>[...e[9]||(e[9]=[p("退出",-1)])]),_:1})):$("",!0)])]),_:1}),t(me,{style:{padding:"12px"}},{default:l(()=>[w.value?(f(),y("div",he,[t(de,{"model-value":P.value,"onUpdate:modelValue":e[7]||(e[7]=s=>P.value=s)},{default:l(()=>[t(D,{label:"助手",name:"assistant"},{default:l(()=>[t(r,{shadow:"never"},{default:l(()=>[t(o,{"label-width":"72px"},{default:l(()=>[t(i,{label:"意图"},{default:l(()=>[t(u,{"model-value":C.value,onInput:e[2]||(e[2]=s=>C.value=s),placeholder:"例如：新建员工"},null,8,["model-value"])]),_:1}),t(i,{label:"模式"},{default:l(()=>[t(E,{"model-value":S.value,onChange:e[3]||(e[3]=s=>S.value=s)},{default:l(()=>[t(b,{label:"guided"},{default:l(()=>[...e[12]||(e[12]=[p("引导",-1)])]),_:1}),t(b,{label:"visible_automation"},{default:l(()=>[...e[13]||(e[13]=[p("可见自动化",-1)])]),_:1}),t(b,{label:"api"},{default:l(()=>[...e[14]||(e[14]=[p("接口直连",-1)])]),_:1})]),_:1},8,["model-value"])]),_:1}),t(i,{label:"姓名"},{default:l(()=>[t(u,{"model-value":z.value,onInput:e[4]||(e[4]=s=>z.value=s),placeholder:"例如：张三"},null,8,["model-value"])]),_:1}),t(i,{label:"部门"},{default:l(()=>[t(u,{"model-value":I.value,onInput:e[5]||(e[5]=s=>I.value=s),placeholder:"例如：人事部"},null,8,["model-value"])]),_:1}),t(i,null,{default:l(()=>[t(n,{type:"primary",onClick:Q,style:{width:"100%"}},{default:l(()=>[...e[15]||(e[15]=[p("发送",-1)])]),_:1})]),_:1})]),_:1}),t(N),t(q,{height:"140px"},{default:l(()=>[(f(!0),y(R,null,O(M.value,(s,F)=>(f(),y("div",{key:F,style:{"font-size":"12px"}},k(s),1))),128))]),_:1})]),_:1})]),_:1}),t(D,{label:"网站指南",name:"guide"},{default:l(()=>[t(r,{shadow:"never"},{default:l(()=>[e[25]||(e[25]=c("div",{style:{"margin-bottom":"8px"}},"上传网站 RSS/Atom Feed 文件",-1)),t(ie,{drag:"","auto-upload":!1,"show-file-list":!1,"on-change":X},{default:l(()=>[t(se,null,{default:l(()=>[t(ve(ye))]),_:1}),e[16]||(e[16]=c("div",{class:"el-upload__text"},"拖拽到此或点击上传",-1))]),_:1}),c("div",ke,[t(n,{size:"small",onClick:Y},{default:l(()=>[...e[17]||(e[17]=[p("保存",-1)])]),_:1}),t(n,{size:"small",onClick:Z},{default:l(()=>[...e[18]||(e[18]=[p("读取",-1)])]),_:1}),t(n,{size:"small",type:"danger",onClick:ee},{default:l(()=>[...e[19]||(e[19]=[p("清空",-1)])]),_:1})]),t(N),t(o,{"label-width":"84px"},{default:l(()=>[t(i,{label:"网站地址"},{default:l(()=>[t(u,{"model-value":A.value,onInput:e[6]||(e[6]=s=>A.value=s),placeholder:"https://example.com"},null,8,["model-value"])]),_:1}),t(i,{label:"候选RSS"},{default:l(()=>[c("div",Ce,[t(n,{loading:B.value,size:"small",onClick:ae},{default:l(()=>[...e[20]||(e[20]=[p("发现RSS",-1)])]),_:1},8,["loading"]),t(n,{size:"small",disabled:g.value.length===0,onClick:oe},{default:l(()=>[...e[21]||(e[21]=[p("拉取第一个",-1)])]),_:1},8,["disabled"])])]),_:1})]),_:1}),g.value.length>0?(f(),y("div",Ae,[c("div",Ee,"发现 "+k(g.value.length)+" 个候选：",1),(f(!0),y(R,null,O(g.value,(s,F)=>(f(),y("div",{key:F,style:{display:"flex","justify-content":"space-between",gap:"8px","align-items":"center",padding:"6px 0","border-bottom":"1px solid #eee"}},[c("div",Fe,k(s),1),c("div",null,[t(n,{size:"small",onClick:G=>W(s)},{default:l(()=>[...e[22]||(e[22]=[p("拉取",-1)])]),_:1},8,["onClick"])])]))),128))])):$("",!0),h.value?(f(),j(ue,{key:1,title:h.value,type:"info","show-icon":"",style:{"margin-bottom":"8px"}},null,8,["title"])):$("",!0),t(q,{height:"180px"},{default:l(()=>[_.value.length===0?(f(),j(re,{key:0,description:"暂无功能项"})):(f(),y("div",Se,[(f(!0),y(R,null,O(_.value,(s,F)=>(f(),y("div",{key:F,style:{padding:"8px","border-bottom":"1px solid #eee"}},[c("div",Ne,[c("div",ze,[c("div",Ie,k(s.title),1),c("div",Be,k(s.link),1),c("div",Te,k(s.description),1)]),c("div",Le,[t(n,{size:"small",onClick:G=>te(s.link)},{default:l(()=>[...e[23]||(e[23]=[p("打开页面",-1)])]),_:1},8,["onClick"]),t(n,{size:"small",onClick:G=>C.value=s.title},{default:l(()=>[...e[24]||(e[24]=[p("作为意图",-1)])]),_:1},8,["onClick"])])])]))),128))]))]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"])])):(f(),y("div",we,[t(r,{shadow:"never"},{default:l(()=>[t(o,{model:x.value,"label-width":"72px"},{default:l(()=>[t(i,{label:"用户名"},{default:l(()=>[t(u,{"model-value":x.value.username,onInput:e[0]||(e[0]=s=>x.value.username=s),placeholder:"请输入"},null,8,["model-value"])]),_:1}),t(i,{label:"令牌"},{default:l(()=>[t(u,{"model-value":x.value.token,onInput:e[1]||(e[1]=s=>x.value.token=s),placeholder:"可留空模拟登录"},null,8,["model-value"])]),_:1}),t(i,null,{default:l(()=>[t(n,{type:"primary",onClick:J,style:{width:"100%"}},{default:l(()=>[...e[11]||(e[11]=[p("登录",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]))]),_:1})]),_:1})])}}});_e(je).use(ge).mount("#app");
